<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SECeD - Panel Radio</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#0b1f12" />
</head>
<body class="radio-skin">
  <main class="app" style="position:relative;">
    <div class="brand">
      <img src="logo.svg" alt="SECeD" class="brand-logo" onerror="this.src='logo.png'"/>
    </div>
    <h1>SECeD - Panel Radio</h1>

    <div class="clock-bar">
      <div class="clock">
        <span id="clockTime">--:--:--</span>
        <span class="tz" id="clockTz">Europe/Madrid</span>
        <span class="sync" id="clockSync">sincronizandoâ€¦</span>
      </div>

      <div class="controls-right">
        <div class="radio-inline" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <button id="btnTramo" type="button" class="secondary">TRAMO â–¾</button>
          <button id="btnRadio" type="button" title="Seleccionar Radio">RADIO: â€”</button>
        </div>
        <div class="micro-panel">
          <button id="btnOperador" class="micro-btn" title="Cambiar usuario">ðŸ‘¤</button>
        </div>
      </div>
    </div>

    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <!-- SDK Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <!-- Tu config (sobrescribe si hace falta) -->
  <script src="firebase-config.js"></script>

  <!-- Importante: marcar este documento como Panel Radio + Viewer ANTES de cargar app.js -->
  <script>
    window.VIEWER = true;               // evita que app.js enganche clics del editor
    document.body.classList.add('viewer');
    // Helpers mÃ­nimos del reloj (opcional, si ya lo tienes en app.js puedes quitar esto)
    (function(){
      const TIMEZONE = 'Europe/Madrid';
      const clockTime = document.getElementById('clockTime');
      const clockTz = document.getElementById('clockTz');
      const clockSync = document.getElementById('clockSync');
      if (clockTz) clockTz.textContent = TIMEZONE;
      let timeOffsetMs = 0;
      const pad = n => String(n).padStart(2,'0');
      const renderClock = () => {
        const d = new Date(Date.now() + timeOffsetMs);
        if (clockTime) clockTime.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
      };
      const syncTime = async () => {
        try {
          if (clockSync) { clockSync.textContent = 'sincronizandoâ€¦'; clockSync.className = 'sync'; }
          const res = await fetch(`https://worldtimeapi.org/api/timezone/${encodeURIComponent(TIMEZONE)}`, { cache: 'no-store' });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const data = await res.json();
          const apiMs = Date.parse(data.datetime);
          timeOffsetMs = apiMs - Date.now();
          if (clockSync) { clockSync.textContent = 'ok'; clockSync.className = 'sync ok'; }
        } catch {
          if (clockSync) { clockSync.textContent = 'sin conexiÃ³n'; clockSync.className = 'sync err'; }
        }
      };
      syncTime(); setInterval(renderClock, 1000); setInterval(syncTime, 5*60*1000);
    })();
  </script>

  <!-- Tu lÃ³gica existente -->
  <script src="sync.js"></script>
  <script src="app.js"></script>

  <!-- NUEVO: botÃ³n BANDERA y envÃ­o de alertas -->
  <script src="bandera.js"></script>
</body>
</html>
